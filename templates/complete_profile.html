{% load static %}
{% include 'header.html' %}
{% load crispy_forms_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Profile | chefs.com.ng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        body{
            background-color: grey;
        }
        .konta{
            margin-top: 10rem;
        }

        label{
            font-weight: bold;
        }

        .asteriskField {
            color: red;
            margin-left: 2px;
        }
    </style>

</head>
<body>
    

<div class="container py-5 konta">
  <div class="card shadow-lg mx-auto" style="max-width: 500px;">
    <div class="card-body">
      <h3 class="text-center mb-4">Complete Your Profile</h3>
      <form method="POST">
        {% csrf_token %}
        {{ form|crispy }}
        <button type="submit" class="btn btn-primary w-100 mt-3">Save</button>
      </form>
    </div>
  </div>
</div>

{% include 'footer.html' %}

<script>
document.addEventListener("DOMContentLoaded", function () {

    const password1 = document.querySelector("input[name='password1'], input[name='new_password1'], input[name='password']");
    const password2 = document.querySelector("input[name='password2'], input[name='new_password2'], input[name='confirm_password']");
    const submitButton = document.querySelector("button[type='submit']");

    // Apply toggle only to password fields
    document.querySelectorAll("input[type='password']").forEach(function(field) {

        field.style.paddingRight = "40px"; // Prevent text overlap

        let toggle = document.createElement("span");
        toggle.innerHTML = '<i class="fa fa-eye"></i>';
        toggle.style.position = "absolute";
        toggle.style.right = "12px";
        toggle.style.top = "73%";
        toggle.style.transform = "translateY(-50%)";
        toggle.style.cursor = "pointer";
        toggle.style.color = "#666";
        toggle.style.zIndex = "3";

        // Place toggle icon inside the input wrapper (Bootstrap crispy form usually wraps fields in .form-group or .mb-3)
        let wrapper = field.closest(".form-group, .mb-3, div");
        wrapper.style.position = "relative";
        wrapper.appendChild(toggle);

        toggle.addEventListener("click", function () {
            if (field.type === "password") {
                field.type = "text";
                toggle.innerHTML = '<i class="fa fa-eye-slash"></i>';
            } else {
                field.type = "password";
                toggle.innerHTML = '<i class="fa fa-eye"></i>';
            }
        });
    });

    // Password match validation
    if (password1 && password2) {
        const message = document.createElement("small");
        message.style.display = "block";
        message.style.marginTop = "5px";
        password2.parentNode.appendChild(message);

        function checkMatch() {
            if (password1.value !== password2.value) {
                message.textContent = "❌ Passwords do not match";
                message.style.color = "red";
                submitButton.disabled = true;
            } else {
                message.textContent = "✅ Passwords match";
                message.style.color = "green";
                submitButton.disabled = false;
            }
        }

        password1.addEventListener("input", checkMatch);
        password2.addEventListener("input", checkMatch);
    }

});
</script>

</body>
</html>
