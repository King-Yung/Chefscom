{% load static %}
{% include 'header.html' %}
<head>
  <title>Chef Dashboard | chefs.com.ng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    .profile-pic-wrapper {
      position: relative;
      display: inline-block;
    }
    .profile-pic {
      object-fit: cover;
      transition: opacity 0.3s ease;
    }
    .edit-overlay {
      position: absolute;
      top: 0; left: 0;
      width: 120px; height: 120px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.4);
      opacity: 0;
      display: flex; justify-content: center; align-items: center;
      transition: opacity 0.3s ease;
      cursor: pointer;
    }
    .profile-pic-wrapper:hover .edit-overlay { opacity: 1; }
    .edit-icon { color: #fff; font-size: 1.5rem; cursor: pointer; }

    /* ‚úÖ Verified Badge Styles */
    .verified-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: #e7f5ff;
      color: #007bff;
      font-weight: 600;
      font-size: 0.9rem;
      padding: 4px 10px;
      border-radius: 20px;
    }
    .verified-badge i {
      color: #0d6efd;
    }

    .testimony-form {
      margin-top: 1rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
    }

    /* Notification badge */
.badge-counter {
    position: absolute;
    top: -5px;
    right: -10px;
    background: red;
    color: white;
    font-size: 0.7rem;
    padding: 3px 7px;
    border-radius: 50%;
}
.btn-badge-wrapper {
    position: relative;
    display: inline-block;
}

.badge-new {
    background: red;
    color: white;
    padding: 3px 8px;
    border-radius: 50%;
    font-size: 12px;
    font-weight: bold;
    position: absolute;
    top: -5px;
    right: -10px;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}

  </style>
</head>

<body class="bodyi">
  <!-- Loader -->
  <div id="preloader">
    <div id="status">
      <div class="spinner">
        <div class="double-bounce1"></div>
        <div class="double-bounce2"></div>
      </div>
    </div>
  </div>

  <div class="container py-5 chefdash">
    <div class="card shadow-lg border-0 rounded-4">
      <div class="card-body text-center">

        <!-- Profile Picture -->
        <div class="mb-4 text-center" style="margin-top: 1rem;">
          <div class="profile-pic-wrapper">
            {% if chef.profile_picture %}
              <img src="{{ chef.profile_picture.url }}" class="rounded-circle mb-3 shadow-sm profile-pic" width="120" height="120">
            {% else %}
              <img src="https://www.seekpng.com/png/detail/514-5147412_default-avatar-icon.png"
                   class="rounded-circle mb-3 shadow-sm profile-pic" width="120" height="120">
            {% endif %}
            <div class="edit-overlay">
              <label for="profile_picture" class="edit-icon"><i class="bi bi-pencil-fill"></i></label>
            </div>
          </div>

          <form method="POST" enctype="multipart/form-data" style="display:inline;">
            {% csrf_token %}
            <input type="file" name="profile_picture" id="profile_picture" accept="image/*"
                   class="form-control mb-2" style="display:none;" onchange="this.form.submit()">
          </form>
        </div>

        <!-- ‚úÖ Welcome with Verification -->
        <h3 class="mb-3">
          üë®‚Äçüç≥ Welcome, {{ chef.user.first_name }} {{ chef.user.last_name }}!
          {% if chef.is_verified_2 %}
            <span class="verified-badge"><i class="bi bi-patch-check-fill"></i> Verified</span>
          {% endif %}
        </h3>

        <p class="text-muted mb-1">Email: {{ chef.user.email }}</p>
        <p class="text-muted mb-1">Phone: {{ chef.phone_number }}</p>
        <p class="text-muted mb-3">Country: {{ chef.nationality }}</p>
        <hr class="my-4">

        <div class="d-flex justify-content-center flex-wrap gap-3 mb-4">

      <!-- My Jobs with Badge -->
      <div class="btn-badge-wrapper">
            <a href="{% url 'my_jobs' %}" class="btn btn-outline-primary">
                My Jobs
            </a>
            {% if my_jobs_count > 0 %}
            <span class="badge-new">{{ my_jobs_count }}</span>
            {% endif %}
        </div>

        <!-- Job Alerts with Badge -->
        <div class="btn-badge-wrapper">
            <a href="{% url 'job_alerts' %}" class="btn btn-outline-success">
                Job Alerts
            </a>
            {% if job_alerts_count > 0 %}
            <span class="badge-new">{{ job_alerts_count }}</span>
            {% endif %}
        </div>

        <a href="{% url 'chef_settings' %}" class="btn btn-outline-info">Settings</a>
        <a href="{% url 'logout' %}" class="btn btn-danger">Logout</a>

      </div>

      </div>
    </div>
  </div>

  <!-- ================= JAVASCRIPT ================= -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <script>
  $(document).ready(function(){

    function sendAction(engagementId, actionUrl){
      $.ajax({
        url: actionUrl,
        type: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}" },
        success: function(response){
          if(response.success){
            alert(response.message || "‚úÖ Action completed successfully.");
            location.reload();
          } else {
            alert(response.message || "Something went wrong.");
          }
        },
        error: function(){ alert("Error. Please try again."); }
      });
    }

    $(".accept-btn").click(function(){ 
      const id = $(this).data("id");
      if(confirm("Accept this job engagement?")){
        sendAction(id, `/engagement/${id}/accept/`);
      }
    });

    $(".reject-btn").click(function(){
      const id = $(this).data("id");
      if(confirm("Reject this job engagement?")){
        sendAction(id, `/engagement/${id}/reject/`);
      }
    });

    $(".submit-testimony-btn").click(function(){
      const id = $(this).data("id");
      const testimony = $(`#testimony-form-${id} .testimony-input`).val().trim();
      if (!testimony) {
        alert("Please write your testimony before submitting.");
        return;
      }

      fetch(`/engagement/${id}/chef_testimony/`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({ testimony })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          $(`#testimony-form-${id}`).hide();
          $(`#testimony-success-${id}`).removeClass("d-none").text("‚úÖ " + data.message);
        } else {
          alert(data.message || "Something went wrong.");
        }
      })
      .catch(err => {
        console.error(err);
        alert("Error submitting testimony.");
      });
    });
  });
</script>


  

  {% include 'footer.html' %}
</body>
